
# Сервис httpClip

### Общие требования:

-   Приложение на Java с использованием Spring Boot.
-   Хранение данных в памяти приложения (без использования базы данных).
-   Поддержка API-документации с использованием Swagger.
-   Валидация входных данных на серверной стороне.
-   Три вида API: REST, WebSocket и SSE для различных вариантов обмена данными.

### Сущность

json

Копировать код

`{
  "client": "8df8e827-1ef2-4449-a9e7-c773d93017ea",
  "hash": "3f86353c-4d6e-4aea-940b-4bad1ea31970",
  "text": "someText usually not readable"
}` 

#### Поля

-   `client`: уникальный идентификатор клиента. Требования:
    -   Длина строки должна быть 32 и более символов.
    -   Строка должна иметь признаки случайности.
-   `hash`: хеш-сумма сообщения, определяемая клиентом. Требования:
    -   Длина строки должна быть 32 и более символов.
-   `text`: произвольный текст любой длины.

#### Уникальность сущности

-   Ключ для хранения: комбинация (`client`, `hash`).
-   История сущностей хранить не требуется — каждая новая сущность для `client` перезаписывает старую.

### Структура API

#### 1. REST API

##### Метод создания сущности

-   **URL**: `/api/messages`
-   **Метод**: `POST`
-   **Тело запроса**: JSON-объект сущности.
-   **Ответ**: код 201 при успешном создании, или 400 в случае невалидных данных.
-   **Валидация**:
    -   Проверка длины `client` и `hash`.
-   **Описание**:
    -   Метод создает сущность и сохраняет её в памяти.
    -   Если сущность для данного `client`+`hash` уже существует, она перезаписывается.

##### Метод получения сущности по `client`

-   **URL**: `/api/messages/{client}`
-   **Метод**: `GET`
-   **Параметры пути**: `client` — идентификатор клиента.
-   **Ответ**: JSON-объект сущности, или 404, если сущность не найдена.
-   **Описание**:
    -   Возвращает последнюю сохраненную сущность для указанного клиента.

##### Метод проверки наличия сущности по `client` и `hash`

-   **URL**: `/api/messages/{client}/{hash}/exists`
-   **Метод**: `GET`
-   **Параметры пути**: `client`, `hash`.
-   **Ответ**: JSON `{ "exists": true }`, если сущность существует; `{ "exists": false }` в противном случае.
-   **Описание**:
    -   Метод проверяет наличие сущности для заданных `client` и `hash`.
    -   Используется для сокращения трафика при long polling.

#### 2. WebSocket API

##### Подписка на сообщения по `client`

-   **URL**: `/ws/messages/{client}`
-   **Описание**:
    -   Клиенты могут подключиться к WebSocket и подписаться на сообщения, отправляемые для указанного идентификатора `client`.
    -   При обновлении сущности для `client`, всем подписанным клиентам отправляется актуальная версия сущности.

#### 3. SSE (Server-Sent Events) API

##### Подписка на сообщения по `client`

-   **URL**: `/sse/messages/{client}`
-   **Описание**:
    -   Клиенты могут подключиться по SSE для получения оперативных обновлений сущности, связанных с `client`.
    -   Каждое обновление сущности отправляется подписчикам.

### Валидация

-   `client`: проверка длины строки и случайности (например, регулярное выражение, допускающее UUID-формат).
-   `hash`: проверка длины строки.
-   сущности хранятся не более часа
-   в случае если общее клиентов в памяти больше 10 (можно изменить через проперти и передачу в командную строку), то выдавать сообщение при создании сущности Service is full, please change the server
  
### Архитектура

-   **Контроллеры**:
    -   REST контроллер для REST API (`@RestController`).
    -   WebSocket контроллер (`@MessageMapping` для обработки сообщений по WebSocket).
    -   SSE контроллер (`@GetMapping` с поддержкой `SseEmitter` для SSE).
-   **Сервис**: сервисный слой для управления сущностями, поддерживающий операции добавления, получения и проверки сущностей.
-   **Валидатор**: валидатор для проверки `client` и `hash`.
-   **Документация Swagger**: сгенерирована автоматически для всех REST-методов.

### Примерные классы

-   `Message`: класс-сущность с полями `client`, `hash`, `text`.
-   `MessageService`: сервис для управления сущностями в памяти.
-   `MessageRestController`: контроллер для REST API.
-   `MessageWebSocketController`: контроллер для WebSocket.
-   `MessageSseController`: контроллер для SSE.
-   `MessageValidator`: валидатор для `client` и `hash`.

### Примеры запросов

#### Создание сущности (REST)

http

Копировать код

`POST /api/messages
Content-Type: application/json

{
  "client": "8df8e827-1ef2-4449-a9e7-c773d93017ea",
  "hash": "3f86353c-4d6e-4aea-940b-4bad1ea31970",
  "text": "example text"
}` 

#### Получение сущности (REST)

http

Копировать код

`GET /api/messages/8df8e827-1ef2-4449-a9e7-c773d93017ea` 

#### Проверка наличия сущности (REST)

http

Копировать код

`GET /api/messages/8df8e827-1ef2-4449-a9e7-c773d93017ea/3f86353c-4d6e-4aea-940b-4bad1ea31970/exists` 

#### WebSocket подписка

plaintext

Копировать код

`ws://server-address/ws/messages/8df8e827-1ef2-4449-a9e7-c773d93017ea` 

#### SSE подписка

plaintext

Копировать код

`GET /sse/messages/8df8e827-1ef2-4449-a9e7-c773d93017ea` 

### Тестирование

-   Покрыть тестами основные методы REST API.
-   Провести нагрузочное тестирование для проверки устойчивости хранения в памяти.

Эта спецификация позволит разработчику создать серверное приложение с функционалом обмена текстовыми фрагментами между клиентами.
